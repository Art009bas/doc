<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Документы</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .editor-container {
            max-width: 800px;
            margin: 0 auto;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #222;
        }
        
        .editor-content {
            min-height: 300px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: white;
        }
        
        .editor-content:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 1px #3b82f6;
        }
        
        .toolbar {
            display: flex;
            gap: 4px;
            padding: 8px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px 8px 0 0;
            border-bottom: none;
        }
        
        .toolbar-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            color: #4b5563;
            cursor: pointer;
        }
        
        .toolbar-btn:hover {
            background: #e5e7eb;
        }
        
        .toolbar-btn.active {
            background: #e5e7eb;
            color: #1f2937;
        }
        
        .document-card {
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .document-card.selected {
            border-left-color: #3b82f6;
            background-color: #f0f7ff;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Раздел документов -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-file-alt text-blue-500 mr-3"></i>
                    Документы
                </h2>
            </div>
            
            <div class="p-6">
                <!-- Панель управления документами -->
                <div class="flex justify-between items-center mb-6">
                    <div class="relative w-64">
                        <input type="text" id="document-search" placeholder="Поиск документов..." 
                               class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                    </div>
                    
                    <button id="new-document-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center">
                        <i class="fas fa-plus mr-2"></i> Новый документ
                    </button>
                </div>
                
                <!-- Список документов -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6" id="documents-list">
                    <!-- Документы будут здесь -->
                    <div class="text-center py-10 text-gray-400" id="no-documents-message">
                        <i class="fas fa-file-alt text-4xl mb-3"></i>
                        <p>Нет созданных документов</p>
                    </div>
                </div>
                
                <!-- Редактор документа (скрыт по умолчанию) -->
                <div id="document-editor" class="hidden">
                    <div class="flex justify-between items-center mb-4">
                        <input type="text" id="document-title" placeholder="Название документа" 
                               class="text-xl font-semibold px-3 py-2 border-b-2 border-transparent focus:border-blue-500 focus:outline-none w-full max-w-md">
                        
                        <div class="flex space-x-2">
                            <button id="save-document-btn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                <i class="fas fa-save mr-2"></i> Сохранить
                            </button>
                            <button id="close-editor-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                                <i class="fas fa-times mr-2"></i> Закрыть
                            </button>
                        </div>
                    </div>
                    
                    <!-- Панель инструментов редактора -->
                    <div class="toolbar mb-0">
                        <button class="toolbar-btn" data-command="bold" title="Жирный (Ctrl+B)">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="toolbar-btn" data-command="italic" title="Курсив (Ctrl+I)">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button class="toolbar-btn" data-command="underline" title="Подчеркивание (Ctrl+U)">
                            <i class="fas fa-underline"></i>
                        </button>
                        <div class="border-l border-gray-300 mx-2 h-6"></div>
                        <button class="toolbar-btn" data-command="insertUnorderedList" title="Маркированный список">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button class="toolbar-btn" data-command="insertOrderedList" title="Нумерованный список">
                            <i class="fas fa-list-ol"></i>
                        </button>
                        <div class="border-l border-gray-300 mx-2 h-6"></div>
                        <button class="toolbar-btn" data-command="createLink" title="Ссылка">
                            <i class="fas fa-link"></i>
                        </button>
                        <button class="toolbar-btn" data-command="insertImage" title="Изображение">
                            <i class="fas fa-image"></i>
                        </button>
                        <div class="border-l border-gray-300 mx-2 h-6"></div>
                        <button class="toolbar-btn" data-command="undo" title="Отменить (Ctrl+Z)">
                            <i class="fas fa-undo"></i>
                        </button>
                        <button class="toolbar-btn" data-command="redo" title="Повторить (Ctrl+Y)">
                            <i class="fas fa-redo"></i>
                        </button>
                    </div>
                    
                    <!-- Контейнер редактора -->
                    <div id="editor-content" class="editor-content" contenteditable="true">
                        <p>Начните вводить текст здесь...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Состояние документов
        const documentsState = {
            documents: [],
            currentDocument: null,
            searchQuery: ''
        };

        // Элементы DOM
        const elements = {
            documentsList: document.getElementById('documents-list'),
            noDocumentsMessage: document.getElementById('no-documents-message'),
            documentEditor: document.getElementById('document-editor'),
            editorContent: document.getElementById('editor-content'),
            documentTitle: document.getElementById('document-title'),
            newDocumentBtn: document.getElementById('new-document-btn'),
            saveDocumentBtn: document.getElementById('save-document-btn'),
            closeEditorBtn: document.getElementById('close-editor-btn'),
            documentSearch: document.getElementById('document-search'),
            toolbarBtns: document.querySelectorAll('.toolbar-btn')
        };

        // Инициализация редактора
        function initEditor() {
            // Обработчики для кнопок панели инструментов
            elements.toolbarBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const command = this.dataset.command;
                    
                    if (command === 'createLink') {
                        const url = prompt('Введите URL ссылки:', 'https://');
                        if (url) {
                            document.execCommand(command, false, url);
                        }
                    } else if (command === 'insertImage') {
                        const url = prompt('Введите URL изображения:', 'https://');
                        if (url) {
                            document.execCommand(command, false, url);
                        }
                    } else {
                        document.execCommand(command, false, null);
                        this.classList.toggle('active');
                    }
                });
            });

            // Горячие клавиши, окак
            elements.editorContent.addEventListener('keydown', function(e) {
                // Ctrl+B - жирный
                if (e.ctrlKey && e.key === 'b') {
                    e.preventDefault();
                    document.execCommand('bold', false, null);
                    document.querySelector('[data-command="bold"]').classList.toggle('active');
                }
                
                // Ctrl+I - курсив
                if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    document.execCommand('italic', false, null);
                    document.querySelector('[data-command="italic"]').classList.toggle('active');
                }
                
                // Ctrl+U - подчеркивание
                if (e.ctrlKey && e.key === 'u') {
                    e.preventDefault();
                    document.execCommand('underline', false, null);
                    document.querySelector('[data-command="underline"]').classList.toggle('active');
                }
                
                // Ctrl+Z - отменить
                if (e.ctrlKey && e.key === 'z') {
                    document.execCommand('undo', false, null);
                }
                
                // Ctrl+Y - повторить
                if (e.ctrlKey && e.key === 'y') {
                    document.execCommand('redo', false, null);
                }
            });
        }

        // Рендер списка документов
        function renderDocuments() {
            let filteredDocuments = documentsState.documents;
            
            // Применяем поиск, если есть запрос
            if (documentsState.searchQuery) {
                const query = documentsState.searchQuery.toLowerCase();
                filteredDocuments = filteredDocuments.filter(doc => 
                    doc.title.toLowerCase().includes(query) || 
                    doc.content.toLowerCase().includes(query)
                );
            }
            
            if (filteredDocuments.length === 0) {
                elements.noDocumentsMessage.classList.remove('hidden');
                elements.documentsList.innerHTML = '';
            } else {
                elements.noDocumentsMessage.classList.add('hidden');
                
                let documentsHTML = '';
                filteredDocuments.forEach(doc => {
                    const previewText = doc.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...';
                    const date = new Date(doc.updatedAt).toLocaleDateString('ru-RU');
                    
                    documentsHTML += `
                        <div class="document-card bg-white border border-gray-200 rounded-lg p-4 cursor-pointer ${documentsState.currentDocument?.id === doc.id ? 'selected' : ''}" data-id="${doc.id}">
                            <h3 class="font-medium text-gray-800 mb-2 truncate">${doc.title}</h3>
                            <p class="text-sm text-gray-500 mb-3 line-clamp-2">${previewText}</p>
                            <div class="flex justify-between items-center text-xs text-gray-400">
                                <span>${date}</span>
                                <button class="delete-document-btn text-gray-400 hover:text-red-500" data-id="${doc.id}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                elements.documentsList.innerHTML = documentsHTML;
                
                // Добавляем обработчики клика на документы
                document.querySelectorAll('.document-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const docId = this.dataset.id;
                        openDocument(docId);
                    });
                });
                
                // Добавляем обработчики для кнопок удаления
                document.querySelectorAll('.delete-document-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const docId = this.dataset.id;
                        deleteDocument(docId);
                    });
                });
            }
        }

        // Создание нового документа
        function createNewDocument() {
            const newDoc = {
                id: Date.now(),
                title: 'Новый документ',
                content: '<p>Начните вводить текст здесь...</p>',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            documentsState.documents.unshift(newDoc);
            documentsState.currentDocument = newDoc;
            
            // Показываем редактор
            elements.documentEditor.classList.remove('hidden');
            elements.documentTitle.value = newDoc.title;
            elements.editorContent.innerHTML = newDoc.content;
            
            renderDocuments();
            saveToLocalStorage();
        }

        // Открытие документа для редактирования
        function openDocument(docId) {
            const doc = documentsState.documents.find(d => d.id == docId);
            if (!doc) return;
            
            documentsState.currentDocument = doc;
            
            // Показываем редактор
            elements.documentEditor.classList.remove('hidden');
            elements.documentTitle.value = doc.title;
            elements.editorContent.innerHTML = doc.content;
            
            renderDocuments();
        }

        // Сохранение документа
        function saveDocument() {
            if (!documentsState.currentDocument) return;
            
            const title = elements.documentTitle.value.trim() || 'Без названия';
            const content = elements.editorContent.innerHTML;
            
            documentsState.currentDocument.title = title;
            documentsState.currentDocument.content = content;
            documentsState.currentDocument.updatedAt = new Date().toISOString();
            
            // Если это новый документ (еще не в массиве)
            if (!documentsState.documents.some(d => d.id === documentsState.currentDocument.id)) {
                documentsState.documents.unshift(documentsState.currentDocument);
            }
            
            renderDocuments();
            saveToLocalStorage();
        }

        // Удаление документа
        function deleteDocument(docId) {
            if (!confirm('Вы уверены, что хотите удалить этот документ?')) return;
            
            documentsState.documents = documentsState.documents.filter(d => d.id != docId);
            
            // Если удаляем текущий открытый документ
            if (documentsState.currentDocument?.id == docId) {
                closeEditor();
            }
            
            renderDocuments();
            saveToLocalStorage();
        }

        // Закрытие редактора
        function closeEditor() {
            elements.documentEditor.classList.add('hidden');
            documentsState.currentDocument = null;
            renderDocuments();
        }

        // Сохранение в localStorage
        function saveToLocalStorage() {
            localStorage.setItem('documentsData', JSON.stringify(documentsState.documents));
        }

        // Загрузка из localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('documentsData');
            if (savedData) {
                documentsState.documents = JSON.parse(savedData);
                renderDocuments();
            }
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            initEditor();
            loadFromLocalStorage();
            
            // Обработчики событий
            elements.newDocumentBtn.addEventListener('click', createNewDocument);
            elements.saveDocumentBtn.addEventListener('click', saveDocument);
            elements.closeEditorBtn.addEventListener('click', closeEditor);
            
            elements.documentSearch.addEventListener('input', function() {
                documentsState.searchQuery = this.value.trim();
                renderDocuments();
            });
        });
    </script>
</body>
</html>
